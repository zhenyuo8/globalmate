<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>globalmate</title>
    <script src="http://design.yonyoucloud.com/static/jquery/3.2.1/jquery.min.js"></script>
    <script src="./static/js/YYIMSDK.min.js"></script>
    <script src="./static/js/datePicker.js"></script>
    <script src="./src/libs/plupload/plupload.full.min.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
    <script>
      (function () {
        window.code='';
        let authorization=function(redirecturl){
          let url='http://47.94.115.87/globalmate/rest/wechat/oauth/oauthUrl?redirect='+redirecturl;
          let temUrl='http://47.94.115.87/globalmate/rest/wechat/oauth/oauthUrl?redirect=http://f5c22029.ngrok.io';
          $.ajax({
              url:temUrl,
              type:'GET',
              success:function (result) {
                  window.location.href=result.data;
                  window.localStorage.setItem('AUTHORIZATION','true');
              }
          })
        };
        let codeToToken=function(code){
          let url='http://47.94.115.87/globalmate/rest/wechat/oauth/oauthCb?code='+code;
          $.ajax({
            url:url,
            type:'GET',
            success:function (result) {
              window.localStorage.removeItem('TOKEN');
              window.localStorage.setItem('TOKEN',result.data.token);
              window.localStorage.setItem('USERID',result.data.user.id);
              window.localStorage.setItem('OPENID',result.data.user.openid);
            }
          })
        }
//        alert(window.location.href)
//        authorization(window.location.href);

//        window.localStorage.removeItem('TOKEN');
//        window.localStorage.removeItem('AUTHORIZATION');
        if(!window.localStorage.getItem('AUTHORIZATION')){
        //   authorization(window.location.href);
        }
        if(window.location.href.indexOf('code=')>-1){
          let queryArr=window.location.href.split('?')[1].split('&');
          for(var i=0;i<queryArr.length;i++){
            if(queryArr[i]&&queryArr[i].split('=')[0]==='code'){
              window.code=queryArr[i].split('=')[1];
            }
          }
          if(window.code){
            //   codeToToken(window.code);
          }
        }
      })();


    </script>
  </body>
</html>
